#### 正则表达式
正则表达式：==必须要用//来包含规则==
preg_match_all() — 执行一个全局正则表达式匹配
preg_replace()通过正则来替换字符
preg_split()通过正则表达式分割字符串
```php
<?php
$he="hi this his histry";
$str="/hi/";
echo preg_match_all($str,$he,$a)."\n"; //第一个是要匹配的规则，第二个是被匹配的字符串，第三个是匹配出的内容
var_dump($a);
?>
```
![[Pasted image 20240112190124.png]]
###### 正则表达式规则
1. 具体字符
2. 字符查找边界
3. 字符合集`[01234]`
4. 字符补集`[^qxz]`
5. 字符范围`[a-z0-9]`
6. 字符簇
##### 常用字符簇
| 元字符 | 行为 | 示例 |
| ---- | ---- | ---- |
| \b | 与一个字边界匹配。即字与空格间的位置 | er\b 与 “never”中的“er”匹配，但与“verb”中的“er”不匹配 |
| \B | 非边界字匹配 | er\B 与“verb”中的“er”匹配，但与“never”中的“er”不匹配 |
| \d | 数字字符匹配，等效于[0-9] | 在搜索字符串“12 345”中，\d{2} 与“12”和“34”匹配。\d 与“1”，“2”、“3”、“4”和“5”匹配 |
| \D | 非数字字符匹配，等效于[^0-9] | /D+ 与“abc123 def”中的“abc”和“def”匹配 |
| \w | 与 A-Z、a-z、0-9 和下划线中的任意任意字符匹配，等效于[A-Za-z0-9] | 在搜索字符串“The quick brown fox...”中，\w+ 与“The”、“quick”、“brown”和“fox”匹配 |
| \W | 与除 A-Z、a-z、0-9 和下划线以外的任意字符匹配，等效于[^A-Za-z0-9] | 在搜索字符串“The quick brown fox...”中，\W+ 与“...”和所有空格匹配 |
| [xyz] | 字符集，与任何一个指定字符匹配 | [abc] 和 “plain”中的“a”匹配 |
| [^xyz] | 反向字符集，与未指定的任何字符匹配 | [^abc] 与“plain”中的“p”、“1”、“i”和“n”匹配 |
| [a-z] | 字符范围，匹配指定范围内的任何字符 | [a-z] 与“a”到“z”范围内的任何小写字母字符匹配 |
| [^a-z] | 反向字符范围，与不在指定范围内的任何字符匹配 | [^a-z] 与不在范围“a”到“z”内的任何字符匹配 |
| {n} | 正好匹配 n 次，n 是非负整数 | o{2} 与“Bob”中的“o”不匹配，但与“fooood”中的两个“o”匹配 |
| {n,} | 至少匹配 n 次，n 是非负整数  <br>* 与 {0,} 相等  <br>+ 与 {1,} 相等 | o{2} 与“Bob”中的“o”不匹配，但与“fooood”中的所有“o”匹配 |
| {n,m} | 匹配至少 n 次，至多 m 次。n 和 m 是非负整数，其中 n<= m，逗号和数字之间不能有空格  <br>? 与 {0,1} 相等 | 在搜索字符串“1234567”中，\d{1,3} 与“123”、“456”和“7”匹配 |
| (模式) | 与模式匹配并保存匹配项。可以从由 JavaScript 中的 exec Method 返回的数组元素中检索保存的匹配项。若要匹配括号字符()，请使用“\(”或者“\)” | (Chapter\|Section) [1-9] 与 “Chapter 5”匹配，保存“Chapter”以备将来之用 |
| (?:模式) | 与模式匹配，但不保存匹配项，即不会存储匹配项以备将来之用。这对于用“or”字符(\|)组合模式部件的情况很有用 | industry(?:y\|ies) 与 industry\|industries 相等 |
| (?=模式) | 正预测先行。找到一个匹配项后，将在匹配文本之前开始搜索下一个匹配项。不会保存匹配项以备将来之用 | ^(?=_.*\d.{4,8}$ 对密码应用一下限制：  <br>其长度必须介于 4 到 8 字符之间，并且必须至少包含一个数字，在该模式中，*\d 查找后跟有数字的任意多个字符。对于搜索字符串“abc3qr”，与“abc3”匹配。  <br>从该匹配项之前，（而不是之后）开始，{4,8} 与包含 4~8 个字符的字符串匹配，与“abc3qr”匹配。  <br>^ 和 $ 指定搜索字符串的开始和结束位置，将在搜索字符串包含匹配字符之外的任何字符时阻止匹配 |
| (?!模式) | 负预测先行。匹配与模式不匹配的搜索字符串。找到一个匹配项后，将在匹配文本之前开始搜索下一个匹配项。不会保存匹配项以备将来之用 | \b(?!th)/w+\b 与不以“th”开头的单词匹配在该模式中，\b 与一个字边界匹配。对于搜索字符串“quick”，与第一个空格匹配。(?!th) 与非“th”字符串匹配与“qu”匹配，从该匹配项开始，!w+ 与一个字匹配，即与“quick”匹配 |
| \cx | 匹配 x 指示的控制字符。x 的值必须在 A-Z 或 a-z 范围内。如果不是这样，就假定 c 是文本“c”字符本身 | \cM 与 Ctrl+M 或一个回车符匹配 |
| \xn | 匹配 n，此处的 n 是一个十六进制转义码。十六进制转义码必须正好是两位数长。允许在正则表达式中使用 ASCII 代码 | \x41 与“A”匹配、\x41 等效于后跟有“1”的“\x04”（因为 n 必须正好是两位数） |
| \num | 匹配 num，此处的 num 是一个正整数。这是对以保存的匹配项的引用 | (.)\1 与两个连续的相同字符匹配 |
| \n | 标识一个八进制转义码或反向引用。如果 \n 前面至少有 n 个捕获子表达式，那么 n 是反向引用；否则，如果 n 是八进制数（0-7），那么 n 是八进制转义码 | (\d)\1 与两个连续的相同数字匹配 |
| \nm | 标识一个八进制转义码或反向引用。如果 \nm 前面至少有 nm 个捕获子表达式，那么 nm 是反向引用。如果 \nm 前面至少有 n 个捕获子表达式，则 n 是反向引用，后面跟有文本 m。如果上述情况都不存在，当 n 和 m 是八进制数字（0-7）时，\nm 匹配八进制转义码 nm | \11 与制表符匹配 |
| \nml | 当 n 是八进制数字（0-3）、m 和 1 是八进制数字（0-7）时，匹配八进制转义码 nml | \011 与制表符匹配 |
| \un | 匹配 n，其中 n 是以 4 位十进制数字表示的 Unicode 字符 | \u00A9 与版权符号（©️）匹配 |
| \s | 匹配任何空白字符，包括空格、制表符、换页符等等。等价于 [ \f\n\r\t\v]。注意 [Unicode](https://so.csdn.net/so/search?q=Unicode&spm=1001.2101.3001.7020) 正则表达式会匹配全角空格符 |  |
| \S | 非空白。匹配任何非空白字符。 |  |

##### 字符
下表中列出了所有的单字符元字符。

| 元字符 | 行为 | 示例 |
| ---- | ---- | ---- |
| * | 零次或多次匹配前面的字符或子表达式，等效于{0,} | zo* 与 “z”和“zoo”匹配 |
| + | 一次或多次匹配前面的字符或子表达式，等效于{1,} | zo+ 与 “zo”和“zoo”匹配，但与“z”不匹配 |
| ? | 零次或一次匹配前面的字符或子表达式，等效于{0,1}  <br>当 ? 紧随任何其他限定符（*  、+、?、{n}、{n,} 或 {n,m}）之后时，匹配模式是非贪婪的。非贪婪模式匹配搜索到的、尽可能少的字符串，而默认的贪婪模式匹配搜索到的、尽可能多的字符串 | zo? 与“z”和“zo”匹配，但与“zoo”不匹配  <br>o+? 只与“oooo”中的单个“o”匹配，而 o+ 与所有“o”匹配  <br>do(es)? 与“do”或“does”中的“do”匹配 |
| ^ | 匹配搜索字符串开始的位置。如果标志中包括 m（多行搜索）字符，^ 还将匹配 \n 或 \r 后面的位置。如果将 ^ 用作括号表达式中的第一个字符，就会对字符集取反 | ^\d{3} 与搜索字符串开始处的 3 个字符匹配  <br>[^abc] 与除 a、b、c 以外的任何字符匹配 |
| $ | 匹配搜索字符串结束的位置。如果标志中包括 m（多行搜索）字符，^ 还将匹配 \n 或 \r 前面的位置。 | \d{3}$ 与搜索字符串结尾处的 3 个数字匹配 |
| . | 匹配除换行符 \n 之外的任何单个字符。若要匹配包括 \n 在内的任意字符，请使用诸如 [\s\S] 之类的模式 | a.c 与 “abc”“a1c”和“a-c”匹配 |
| [] | 标记括号表达式的开始和结尾 | [1-4] 与“1”、“2”、“3”或“4”匹配  <br>[^aAeEiIoOuU] 与任何非元音字符匹配 |
| {} | 标记限定符表达式的开始和结尾 | a{2,3} 与“aa”和“aaa”匹配 |
| () | 标记子表达式的开始和结尾，可以保存子表达式，以备将来之用 | A(\d) 与“A0”至“A9”匹配。保存该数字以备将来之用 |
| \| | 指示两个或多个项之间进行选择 | z\|food 与“z”或“food”匹配  <br>(z\|f)ood 与 “zood”或“food”匹配 |
| / | 表示 JavaScript 中的文本正则表达式模式的开始和结尾。在第二个 “/”后添加单字符标志可以指定搜索行为 | /abc/gi 是与 “abc”匹配的 JavaScript 文本正则表达式。g（全局）标志指定查找模式的所有匹配项，i（忽略大小写）标志使搜索不区分大小写 |
| \|将下一字符标记为特殊字符、文本、反向引用或八进制转义符 | \n 与换行符匹配。\( 与 “(”匹配。\\ 与 “\”匹配 |  |
| \ | 转义字符 |  |
##### 优先级

在使用正则表达式时，需要注意匹配的顺序。通常相同优先级是从左到右进行运算的，不同优先级的运算先高后低。各种操作符的匹配顺序优先级从高到低，如下表所示。  

| 顺序 | 元字符 | 描述 |
| ---- | ---- | ---- |
| 1 | \转义符 |  |
| 2 | ( )、(?:)、(?=)、[ ] | 括号和中括号 |
| 3 | *、+、{n}、{n，}、{n,m} | 限定符 |
| 4 | ^、$、\ 任何元字符 | 定位点和序列 |
| 5 | \| | 替换 |
##### 替换
正则表达式中的替换允许对两个或多个替换选项之间的选择进行分组，`|`字符指定两个或多个替换选项之间的选择。
```
/Chapter|Section [1-9][0-9]{0,1}/
```

该正则表达式匹配的是字符串“Chapter”或者字符串“Section”后跟一个或两个数字，这和优先级有很大的关系。
![[Pasted image 20240113144624.png]]
如果要实现两个都是后跟一个或两个数字就要加小括号
```
/(Chapter|Section) [1-9][0-9]{0,1}/
```
![[Pasted image 20240113144706.png]]
###### 子表达式
正则中放置括号可以创建子表达式，子表达式允许匹配搜索文本中的模式并将匹配项分成多个单独的子匹配项，程序可检索生成的子匹配项。

例如匹配邮箱账号的正则表达式：

```
/(\w+)@(\w+)\.(\w+)/
```

该正则表达式包含 3 个子表达式，3 个子表达式分别进行匹配并保留匹配结果，与其他表达式匹配结果作为一个整体显示出来。

然后写一个url匹配的正则表达式

```
/(\w+):\/\/([^\/:]+)(:\d*)?([^#]*)/
```

###### 反向引用
反向引用用于查找重复字符组。此外，可使用反向引用来重新排列输入字符串中各个元素的顺序和位置，以重新设置输入字符串的格式

###### 环视
只找位置不匹配，不起作用
(?=模式)
正预测先行。找到一个匹配项后，将在匹配文本之前开始搜索下一个匹配项。不会保存匹配项以备将来之用

(?!模式)就是上面取反一样
###### 贪婪匹配
```
<.+>
```
![[Pasted image 20240113210924.png]]
###### 非贪婪匹配
```
<.+?>
```
![[Pasted image 20240113210858.png]]
